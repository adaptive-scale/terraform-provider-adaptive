---
page_title: "adaptive_script Resource - terraform-provider-adaptive"
subcategory: ""
description: |-
  Manages an Adaptive script, which executes commands on endpoints for automation.
---

# adaptive_script (Resource)

The `adaptive_script` resource allows you to define and execute commands on Adaptive endpoints. Scripts are useful for:

- **Automation** - Run setup scripts, migrations, or maintenance tasks
- **Provisioning** - Initialize databases, create users, or set up schemas
- **Operations** - Execute operational commands during Terraform apply

## Example Usage

### Basic Script Execution

```terraform
resource "adaptive_script" "init_db" {
  name     = "initialize-database"
  endpoint = adaptive_endpoint.postgres.name
  command  = "CREATE TABLE IF NOT EXISTS users (id SERIAL PRIMARY KEY, name VARCHAR(100));"
}
```

### Database Migration Script

```terraform
resource "adaptive_script" "migration" {
  name     = "run-migrations"
  endpoint = adaptive_endpoint.postgres.name
  command  = <<-EOT
    CREATE TABLE IF NOT EXISTS schema_migrations (
      version VARCHAR(255) PRIMARY KEY,
      applied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );
    INSERT INTO schema_migrations (version) VALUES ('001_initial') ON CONFLICT DO NOTHING;
  EOT
}
```

### Create Database User

```terraform
resource "adaptive_script" "create_user" {
  name     = "create-app-user"
  endpoint = adaptive_endpoint.postgres.name
  command  = <<-EOT
    DO $$
    BEGIN
      IF NOT EXISTS (SELECT FROM pg_roles WHERE rolname = 'app_user') THEN
        CREATE USER app_user WITH PASSWORD 'secure_password';
        GRANT SELECT, INSERT, UPDATE ON ALL TABLES IN SCHEMA public TO app_user;
      END IF;
    END
    $$;
  EOT
}
```

### Kubernetes Namespace Setup

```terraform
resource "adaptive_script" "k8s_setup" {
  name     = "setup-namespace"
  endpoint = adaptive_endpoint.k8s_cluster.name
  command  = "kubectl create namespace app-production --dry-run=client -o yaml | kubectl apply -f -"
}
```

### SSH Server Configuration

```terraform
resource "adaptive_script" "server_setup" {
  name     = "install-packages"
  endpoint = adaptive_endpoint.bastion.name
  command  = "sudo apt-get update && sudo apt-get install -y htop vim curl"
}
```

### MongoDB Index Creation

```terraform
resource "adaptive_script" "create_indexes" {
  name     = "create-mongodb-indexes"
  endpoint = adaptive_endpoint.mongodb.name
  command  = <<-EOT
    db.users.createIndex({ email: 1 }, { unique: true });
    db.orders.createIndex({ userId: 1, createdAt: -1 });
    db.products.createIndex({ category: 1, price: 1 });
  EOT
}
```

### Multiple Scripts with Dependencies

```terraform
# First: Create the schema
resource "adaptive_script" "create_schema" {
  name     = "create-schema"
  endpoint = adaptive_endpoint.postgres.name
  command  = "CREATE SCHEMA IF NOT EXISTS app;"
}

# Second: Create tables (depends on schema)
resource "adaptive_script" "create_tables" {
  name     = "create-tables"
  endpoint = adaptive_endpoint.postgres.name
  command  = <<-EOT
    CREATE TABLE IF NOT EXISTS app.users (
      id SERIAL PRIMARY KEY,
      email VARCHAR(255) UNIQUE NOT NULL,
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );
    CREATE TABLE IF NOT EXISTS app.orders (
      id SERIAL PRIMARY KEY,
      user_id INTEGER REFERENCES app.users(id),
      total DECIMAL(10,2),
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );
  EOT

  depends_on = [adaptive_script.create_schema]
}

# Third: Create indexes (depends on tables)
resource "adaptive_script" "create_indexes" {
  name     = "create-indexes"
  endpoint = adaptive_endpoint.postgres.name
  command  = <<-EOT
    CREATE INDEX IF NOT EXISTS idx_users_email ON app.users(email);
    CREATE INDEX IF NOT EXISTS idx_orders_user ON app.orders(user_id);
    CREATE INDEX IF NOT EXISTS idx_orders_created ON app.orders(created_at DESC);
  EOT

  depends_on = [adaptive_script.create_tables]
}
```

### Complete Example

```terraform
# Create the resource
resource "adaptive_resource" "postgres" {
  name          = "app-database"
  type          = "postgres"
  host          = "postgres.example.com"
  port          = "5432"
  username      = "admin"
  password      = var.db_password
  database_name = "myapp"
}

# Create the endpoint
resource "adaptive_endpoint" "postgres" {
  name     = "app-database-admin"
  resource = adaptive_resource.postgres.name
  users    = ["admin@example.com"]
}

# Run initialization scripts
resource "adaptive_script" "init" {
  name     = "initialize-app-database"
  endpoint = adaptive_endpoint.postgres.name
  command  = <<-EOT
    -- Create application schema
    CREATE SCHEMA IF NOT EXISTS app;

    -- Create users table
    CREATE TABLE IF NOT EXISTS app.users (
      id SERIAL PRIMARY KEY,
      email VARCHAR(255) UNIQUE NOT NULL,
      name VARCHAR(100),
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );

    -- Create audit log table
    CREATE TABLE IF NOT EXISTS app.audit_log (
      id SERIAL PRIMARY KEY,
      user_id INTEGER,
      action VARCHAR(50),
      details JSONB,
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );
  EOT
}
```

{{ .SchemaMarkdown | trimspace }}

## Import

Scripts can be imported using the script ID:

```shell
terraform import adaptive_script.example script-id
```
